#!/bin/sh
forge build \
  --force \
  --optimize \
  --optimize-runs 200 \
	--contracts ./src/Token.sol

# solc versions are kept in ~/.svm
# for version debug use RUST_LOG=ethers=trace forge t

export TOKEN_NAME="LuxToken"
export TOKEN_SYMBOL="LUX"
export TOKEN_PRECISION=12
export TOKEN_SUPPLY=1000

cast abi-encode "constructor(string,string,uint8,uint256)" $TOKEN_NAME $TOKEN_SYMBOL $TOKEN_PRECISION $TOKEN_SUPPLY
export CONSTRUCTOR_ABI="000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000a968163f0a57b400000000000000000000000000000000000000000000000000000000000000000000f5772617070656420426974636f696e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000047742544300000000000000000000000000000000000000000000000000000000"

forge create --constructor-args $TOKEN_NAME $TOKEN_SYMBOL $TOKEN_PRECISION $TOKEN_SUPPLY --private-key $PRIVATE_KEY src/test/mocks/ERC20Mintable.sol:ERC20Mintable

forge verify-contract --chain-id $CHAIN_ID --num-of-optimizations 200 --constructor-args $CONSTRUCTOR_ABI --compiler-version $COMPILER_VERSION $ADDRESS src/test/mocks/ERC20Mintable.sol:ERC20Mintable

# forge verify-contract \
#   --chain-id $CHAIN_ID \
#   --num-of-optimizations 200 \
#   --constructor-args $CONSTRUCTOR_ABI \
#   $ADDRESS src/test/mocks/ERC20Mintable.sol:ERC20Mintable

forge verify-check --chain-id $CHAIN_ID $GUID
